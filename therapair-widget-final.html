<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Therapair Widget</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Open Sans', ui-sans-serif, system-ui, sans-serif;
            background-color: #F8F4FF;
            padding: 1rem;
            min-height: 100vh;
        }

        .container {
            max-width: 72rem;
            margin: 0 auto;
        }

        .chat-bubble {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .progress-dot {
            transition: all 0.3s ease;
        }

        .progress-dot.active {
            background-color: #9B74B7;
            transform: scale(1.2);
        }

        .option-button {
            transition: all 0.2s ease;
            cursor: pointer;
            background-color: #9B74B7;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 20px;
            font-weight: 500;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            width: 100%;
            text-align: left;
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }

        .option-button:hover {
            background-color: #4F064F;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(155, 116, 183, 0.25);
        }

        .option-button.selected {
            background-color: #4F064F;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(155, 116, 183, 0.3);
        }

        .option-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .option-button:disabled.selected {
            opacity: 1;
            background-color: #4F064F;
        }

        .therapist-card {
            transition: all 0.3s ease;
            background: white;
            border-radius: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .therapist-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .therapist-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            background-color: #f3f4f6;
            transition: all 0.3s ease;
        }

        .therapist-card img:hover {
            filter: brightness(1.05);
        }

        .chat-message {
            background-color: white;
            border-radius: 16px;
            padding: 16px 20px;
            margin: 8px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .chat-message.bot {
            text-align: left;
            color: #374151;
            font-weight: 500;
        }

        .white-panel {
            background-color: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin: 24px auto;
            max-width: 48rem;
        }

        .btn-primary {
            background-color: #9B74B7;
            color: white;
            padding: 1rem 2rem;
            border-radius: 16px;
            border: none;
            font-weight: 600;
            font-size: 1.125rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            background-color: #4F064F;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(155, 116, 183, 0.25);
        }

        .therapist-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .specialty-tag {
            background-color: #9B74B7;
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            margin: 0.25rem 0.25rem 0.25rem 0;
            display: inline-block;
        }

        .progress-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .progress-dots {
            display: flex;
            gap: 0.5rem;
        }

        .progress-dot {
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
            background-color: #d1d5db;
        }

        .text-center {
            text-align: center;
        }

        .hidden {
            display: none;
        }

        .card-content {
            padding: 1.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .card-buttons {
            margin-top: auto;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .btn-secondary {
            width: 100%;
            background: white;
            border: 2px solid #9B74B7;
            color: #374151;
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background-color: #f9fafb;
        }

        .btn-book {
            width: 100%;
            background-color: #9B74B7;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .btn-book:hover {
            background-color: #4F064F;
            box-shadow: 0 4px 12px rgba(155, 116, 183, 0.25);
        }

        @media (max-width: 768px) {
            .therapist-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 0.5rem;
            }

            .white-panel {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Hero Section -->
        <div class="text-center" style="margin-bottom: 2rem;">
            <h1 style="color: #111827; margin-bottom: 1rem; font-size: 2.5rem; font-weight: 700; line-height: 1.2; max-width: 42rem; margin-left: auto; margin-right: auto;">
                Let's find a therapist who's right for you
            </h1>
            <p style="color: #6b7280; margin-bottom: 2rem; font-size: 1.125rem; max-width: 36rem; margin-left: auto; margin-right: auto;">
                Answer a few quick questions — we'll guide you to someone who really gets it.
            </p>
            <button
                id="start-btn"
                onclick="startMatching()"
                class="btn-primary"
            >
                Start Matching
            </button>
        </div>

        <!-- Chat Interface -->
        <div id="chat-interface" class="hidden">
            <div class="white-panel">
                <!-- Progress Bar -->
                <div class="progress-container">
                    <div class="progress-dots">
                        <div class="progress-dot"></div>
                        <div class="progress-dot"></div>
                        <div class="progress-dot"></div>
                        <div class="progress-dot"></div>
                        <div class="progress-dot"></div>
                    </div>
                    <span id="progress-text" style="font-size: 0.875rem; color: #6b7280;">1 of 5</span>
                </div>

                <!-- Chat Messages -->
                <div id="chat-messages" style="margin-bottom: 1.5rem;">
                    <!-- Messages will be added here dynamically -->
                </div>

                <!-- Options Container -->
                <div id="options-container">
                    <!-- Options will be added here dynamically -->
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results-section" class="hidden">
            <div class="text-center" style="margin-bottom: 2rem;">
                <h2 style="color: #111827; margin-bottom: 1rem; font-size: 1.875rem; font-weight: 700;">Here are your matches</h2>
                <p style="color: #6b7280; font-size: 1.125rem;">Based on your responses, we think you'll connect well with:</p>
            </div>

            <div id="therapist-cards" class="therapist-grid">
                <!-- Therapist cards will be added here -->
            </div>

            <div class="text-center" style="margin-top: 2rem;">
                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 1rem;">Not quite right?</p>
                <div>
                    <button onclick="restartQuiz()" style="color: #9B74B7; text-decoration: underline; background: none; border: none; cursor: pointer; margin-right: 1rem; font-size: 0.875rem;">
                        Retake quiz
                    </button>
                    <button style="color: #9B74B7; text-decoration: underline; background: none; border: none; cursor: pointer; font-size: 0.875rem;">
                        Explore all therapists
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center" style="margin-top: 4rem; padding-top: 2rem; border-top: 1px solid #e5e7eb;">
            <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem;">
                Powered by Therapair for Unison
            </p>
            <p style="font-size: 0.75rem; color: #9ca3af;">
                Find mental health support that understands you
            </p>
        </div>
    </div>

    <script>
        // Image paths for root directory deployment
        const IMAGE_PATHS = [
            '/images/therapair/',
            '/therapair-images/',
            '/images/',
            './images/therapair/',
            './images/'
        ];

        function getImagePath(filename) {
            // Try each path
            for (let path of IMAGE_PATHS) {
                const fullPath = path + filename;
                return fullPath;
            }
            return filename;
        }

        // Therapist data with fallback images
        const therapists = [
            {
                name: "Nicki Nelis",
                gender: "female",
                image: getImagePath("nicki-nelis-therapair-counsellor.jpg"),
                tagline: "Gestalt therapist with nearly 20 years' experience, specializing in LGBTQI+, trauma survivors, and kink/ENM communities",
                specialties: ["LGBTQI+ affirming", "Trauma survivors", "Kink community", "ENM relationships", "Sexual assault survivors"],
                availability: "In-person Windsor (Thursdays 10am–7pm)",
                tags: ["lgbtq", "trauma", "kink", "enm", "identity"],
                accepting: true
            },
            {
                name: "Adam Forman",
                gender: "male",
                image: getImagePath("adam-forman-therapair-counsellor.jpg"),
                tagline: "Counsellor & Mediator with two decades experience, specializing in ethically non-monogamous relationships",
                specialties: ["ENM relationships", "Opening relationships", "Relationship dynamics", "Attachment healing", "Mediation"],
                availability: "Online & in-person Fitzroy North (Flexible)",
                tags: ["enm", "relationship", "mediation"],
                accepting: true
            },
            {
                name: "Natasha Lama",
                gender: "female",
                image: getImagePath("natasha-lama-therapair-sex-therapist.jpg"),
                tagline: "Counsellor & Sex Therapist with cultural sensitivity, specializing in sex-positive approaches and cultural identity",
                specialties: ["Sex therapy", "Cultural sensitivity", "Sexual health", "Cultural identity", "CBT", "Mindfulness"],
                availability: "Online and in-person Windsor (Mondays noon–7pm, Saturdays 9am–2pm)",
                tags: ["sexual_health", "cultural", "sex_positive"],
                accepting: true
            },
            {
                name: "Genevieve Autret",
                gender: "female",
                image: getImagePath("genevieve-autret-therapair-psychotherapist.jpg"),
                tagline: "Psychotherapist with 15 years experience, specializing in psychedelic integration and trauma-informed therapy",
                specialties: ["Psychedelic integration", "Trauma therapy", "DBT", "Art therapy", "Harm reduction", "Couples therapy"],
                availability: "Online (Tuesdays 4:30–6:30pm, Wednesdays noon–6pm)",
                tags: ["psychedelic", "trauma", "art_therapy"],
                accepting: true
            },
            {
                name: "Emma Steains",
                gender: "female",
                image: getImagePath("emma-steains-therapair-clinical-psychologist.jpg"),
                tagline: "Clinical Psychologist specializing in veterans/ADF personnel, EMDR, ACT, and trauma recovery",
                specialties: ["EMDR", "ACT", "CBT", "Veteran support", "ADF families", "Trauma recovery", "Internal Family Systems"],
                availability: "Online (Wednesdays 2–6pm, Fridays 9am–5pm)",
                tags: ["emdr", "veterans", "trauma", "cbt"],
                accepting: true
            },
            {
                name: "Michael Spurrier",
                gender: "male",
                image: getImagePath("michael-spurrier-therapair-clinical-psychologist.jpg"),
                tagline: "Clinical Psychologist providing warm, grounded therapy for trauma, relationships, neurodivergence, mood, and addiction",
                specialties: ["Trauma therapy", "Relationship work", "Neurodivergent support", "Mood disorders", "Addiction", "Schema therapy"],
                availability: "Online (Mondays 9am–3pm)",
                tags: ["trauma", "relationship", "addiction", "neurodivergent"],
                accepting: true
            },
            {
                name: "Meg Wilson",
                gender: "female",
                image: getImagePath("meg-wilson-therapair-psychotherapist.jpg"),
                tagline: "Founder & Psychotherapist with over a decade experience in art psychotherapy, DBT, and relationship therapy",
                specialties: ["Art psychotherapy", "DBT", "Mindfulness", "Relationship therapy", "Non-traditional relationships"],
                availability: "Online/in-person Windsor (Not currently accepting new clients)",
                tags: ["art_therapy", "relationship", "founder"],
                accepting: false
            },
            {
                name: "Joe Stark",
                gender: "male",
                image: getImagePath("joe-stark-therapair-psychiatrist.jpg"),
                tagline: "Psychiatrist & Psychotherapist, pioneer in psychedelic-assisted therapy and mindfulness teacher",
                specialties: ["Psychiatry", "Psychedelic therapy", "Mindfulness", "Chronic pain", "Trauma", "Anxiety"],
                availability: "Not accepting new clients; medication-assisted treatments by enquiry",
                tags: ["psychedelic", "psychiatry", "mindfulness"],
                accepting: false
            }
        ];

        // Questions data
        const questions = [
            {
                id: "concerns",
                text: "What brings you to therapy?",
                options: [
                    "Relationship challenges",
                    "Anxiety or depression",
                    "Trauma or PTSD",
                    "Personal growth/self-exploration",
                    "Identity exploration",
                    "Sexual health concerns",
                    "Addiction recovery",
                    "Psychedelic integration"
                ]
            },
            {
                id: "relationship",
                text: "Which relationship structure applies to you?",
                options: [
                    "Monogamous relationship",
                    "Non-monogamous/ENM relationship",
                    "Single/dating",
                    "Not relevant to my needs"
                ]
            },
            {
                id: "approach",
                text: "Do you have preferences regarding therapeutic approaches?",
                options: [
                    "Art-based therapy",
                    "CBT/DBT skills-focused",
                    "Mindfulness/acceptance-based",
                    "Trauma-specific approaches (EMDR)",
                    "No preference/unsure"
                ]
            },
            {
                id: "community",
                text: "Are any of these community experiences relevant to you?",
                options: [
                    "LGBTQI+ community",
                    "Cultural/ethnic minority",
                    "Veterans/ADF personnel or family",
                    "Kink community",
                    "None of these apply"
                ]
            },
            {
                id: "gender",
                text: "Therapist gender preference?",
                options: [
                    "Prefer female therapist",
                    "Prefer male therapist",
                    "No preference"
                ]
            }
        ];

        let currentQuestion = 0;
        let responses = {};

        function startMatching() {
            currentQuestion = 0;
            responses = {};

            document.getElementById('chat-messages').innerHTML = '';
            document.getElementById('options-container').innerHTML = '';

            const progressDots = document.querySelectorAll('.progress-dot');
            progressDots.forEach(dot => dot.classList.remove('active'));

            document.getElementById('progress-text').textContent = '1 of 5';
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('chat-interface').classList.remove('hidden');

            showQuestion(0);
        }

        function showQuestion(index) {
            currentQuestion = index;
            const question = questions[index];

            updateProgress(index);

            document.getElementById('chat-messages').innerHTML = '';
            document.getElementById('options-container').innerHTML = '';

            addChatBubble(question.text, 'bot');

            setTimeout(() => {
                question.options.forEach((option, i) => {
                    setTimeout(() => {
                        addOptionButton(option);
                    }, i * 100);
                });
            }, 500);
        }

        function updateProgress(index) {
            const dots = document.querySelectorAll('.progress-dot');
            const progressText = document.getElementById('progress-text');

            dots.forEach((dot, i) => {
                if (i <= index) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });

            progressText.textContent = `${index + 1} of ${questions.length}`;
        }

        function addChatBubble(message, sender) {
            const chatMessages = document.getElementById('chat-messages');
            const bubble = document.createElement('div');

            if (sender === 'bot') {
                bubble.className = 'chat-message bot';
                bubble.innerHTML = message;
            } else {
                bubble.className = 'chat-bubble';
                bubble.style.display = 'flex';
                bubble.style.justifyContent = 'flex-end';
                bubble.innerHTML = `
                    <div style="max-width: 20rem; padding: 0.75rem 1rem; border-radius: 1rem; color: white; background-color: #9B74B7;">
                        ${message}
                    </div>
                `;
            }

            chatMessages.appendChild(bubble);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addOptionButton(option) {
            const container = document.getElementById('options-container');
            const button = document.createElement('button');

            button.className = 'option-button';
            button.textContent = option;

            button.onclick = () => selectOption(option, button);

            container.appendChild(button);
        }

        function selectOption(option, buttonElement) {
            buttonElement.classList.add('selected');
            buttonElement.disabled = true;

            responses[questions[currentQuestion].id] = option;

            const allOptions = document.querySelectorAll('.option-button');
            allOptions.forEach(opt => opt.disabled = true);

            setTimeout(() => {
                if (currentQuestion < questions.length - 1) {
                    showQuestion(currentQuestion + 1);
                } else {
                    showResults();
                }
            }, 1000);
        }

        function showResults() {
            document.getElementById('chat-interface').classList.add('hidden');
            document.getElementById('results-section').classList.remove('hidden');

            const matchedTherapists = getMatchedTherapists();
            displayTherapistCards(matchedTherapists);
        }

        function getMatchedTherapists() {
            const genderPreference = responses.gender;
            const acceptingTherapists = therapists.filter(t => t.accepting);

            let eligibleTherapists = acceptingTherapists;
            if (genderPreference === 'Prefer male therapist') {
                eligibleTherapists = acceptingTherapists.filter(t => t.gender === 'male');
            } else if (genderPreference === 'Prefer female therapist') {
                eligibleTherapists = acceptingTherapists.filter(t => t.gender === 'female');
            }

            const matches = [];
            const concerns = responses.concerns;
            const relationship = responses.relationship;
            const approach = responses.approach;
            const community = responses.community;

            // Matching logic
            if (concerns === 'Relationship challenges') {
                if (relationship === 'Non-monogamous/ENM relationship') {
                    matches.push(...eligibleTherapists.filter(t => t.tags.includes('enm')));
                } else {
                    matches.push(...eligibleTherapists.filter(t => t.tags.includes('relationship')));
                }
            }

            if (relationship === 'Non-monogamous/ENM relationship') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('enm') || t.tags.includes('kink')));
            }

            if (community === 'LGBTQI+ community' || community === 'Kink community') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('lgbtq') || t.tags.includes('kink')));
            }

            if (concerns === 'Psychedelic integration') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('psychedelic')));
            }

            if (community === 'Veterans/ADF personnel or family') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('veterans')));
            }

            if (concerns === 'Sexual health concerns') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('sexual_health')));
            }

            if (concerns === 'Trauma or PTSD' || approach === 'Trauma-specific approaches (EMDR)') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('trauma') || t.tags.includes('emdr')));
            }

            if (community === 'Cultural/ethnic minority') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('cultural')));
            }

            if (concerns === 'Identity exploration') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('identity') || t.tags.includes('lgbtq')));
            }

            if (approach === 'Art-based therapy') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('art_therapy')));
            }

            if (concerns === 'Addiction recovery') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('addiction')));
            }

            const uniqueMatches = matches.filter((therapist, index, self) =>
                index === self.findIndex(t => t.name === therapist.name)
            );

            let finalMatches = uniqueMatches;
            if (finalMatches.length === 0) {
                finalMatches = eligibleTherapists.slice(0, 3);
            }

            return finalMatches.slice(0, 3);
        }

        function displayTherapistCards(therapists) {
            const container = document.getElementById('therapist-cards');

            therapists.forEach((therapist, index) => {
                setTimeout(() => {
                    const card = createTherapistCard(therapist);
                    container.appendChild(card);
                }, index * 200);
            });
        }

        function createTherapistCard(therapist) {
            const card = document.createElement('div');
            card.className = 'therapist-card';

            // Generate a nice gradient fallback based on the therapist's name
            const nameHash = therapist.name.split('').reduce((a, b) => {
                a = ((a << 5) - a) + b.charCodeAt(0);
                return a & a;
            }, 0);
            const hue = Math.abs(nameHash) % 360;
            const fallbackGradient = `linear-gradient(45deg, hsl(${hue}, 70%, 60%), hsl(${(hue + 60) % 360}, 70%, 70%))`;

            card.innerHTML = `
                <div style="position: relative;">
                    <img
                        src="${therapist.image}"
                        alt="${therapist.name} - Therapist at Therapair"
                        style="width: 100%; height: 250px; object-fit: cover; background: ${fallbackGradient};"
                        onerror="this.style.background='${fallbackGradient}'; this.style.display='none'; this.nextElementSibling.style.display='flex';"
                        onload="console.log('Image loaded:', '${therapist.name}');"
                    />
                    <div style="display: none; width: 100%; height: 250px; ${fallbackGradient}; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.2rem;">
                        ${therapist.name.split(' ').map(n => n[0]).join('')}
                    </div>
                </div>

                <div class="card-content">
                    <div style="margin-bottom: 1rem;">
                        <h3 style="color: #111827; margin-bottom: 0.5rem; font-size: 1.25rem; font-weight: 700; margin-top: 0;">${therapist.name}</h3>
                        <p style="color: #6b7280; font-size: 0.875rem; line-height: 1.5; margin: 0;">${therapist.tagline}</p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.75rem; font-weight: 500; margin-top: 0;">Specializes in:</p>
                        <div>
                            ${therapist.specialties.slice(0, 3).map(specialty => `
                                <span class="specialty-tag">${specialty}</span>
                            `).join('')}
                            ${therapist.specialties.length > 3 ? `
                                <span style="background-color: #f9fafb; color: #6b7280; border: 1px solid #e5e7eb; padding: 0.375rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; margin: 0.25rem 0.25rem 0.25rem 0; display: inline-block;">
                                    +${therapist.specialties.length - 3} more
                                </span>
                            ` : ''}
                        </div>
                    </div>

                    <div class="card-buttons">
                        <button class="btn-secondary" onclick="alert('Profile feature coming soon!')">
                            View Profile
                        </button>
                        <button class="btn-book" onclick="alert('Booking feature coming soon!')">
                            Book Now
                        </button>
                    </div>
                </div>
            `;

            return card;
        }

        function restartQuiz() {
            currentQuestion = 0;
            responses = {};

            document.getElementById('chat-messages').innerHTML = '';
            document.getElementById('options-container').innerHTML = '';

            const progressDots = document.querySelectorAll('.progress-dot');
            progressDots.forEach(dot => dot.classList.remove('active'));

            document.getElementById('progress-text').textContent = '1 of 5';
            document.getElementById('results-section').classList.add('hidden');
            document.getElementById('chat-interface').classList.remove('hidden');
            document.getElementById('start-btn').style.display = 'none';

            const therapistCards = document.getElementById('therapist-cards');
            if (therapistCards) {
                therapistCards.innerHTML = '';
            }

            showQuestion(0);
        }
    </script>
</body>
</html>