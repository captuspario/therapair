<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Therapair - Find Your Perfect Therapist Match</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        therapair: {
                            bg: '#D0B2E6',
                            text: '#202020', 
                            primary: '#9B74B7',
                            border: '#EAE6EE',
                        }
                    },
                    fontFamily: {
                        sans: ['Open Sans', 'ui-sans-serif', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        .chat-bubble {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .progress-dot {
            transition: all 0.3s ease;
        }
        
        .progress-dot.active {
            background-color: #9B74B7;
            transform: scale(1.2);
        }
        
        .option-button {
            transition: all 0.2s ease;
            cursor: pointer;
            background-color: #9B74B7;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 20px;
            font-weight: 500;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .option-button:hover {
            background-color: #4F064F;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(155, 116, 183, 0.25);
        }
        
        .option-button.selected {
            background-color: #4F064F;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(155, 116, 183, 0.3);
        }
        
        .option-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .option-button:disabled.selected {
            opacity: 1;
            background-color: #4F064F;
        }
        
        .therapist-card {
            transition: all 0.3s ease;
        }
        
        .therapist-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        /* Ensure square aspect ratio for therapist images */
        .aspect-square {
            aspect-ratio: 1 / 1;
        }
        
        /* Better image loading and display */
        .therapist-card img {
            background-color: #f3f4f6;
            transition: all 0.3s ease;
        }
        
        .therapist-card img:hover {
            filter: brightness(1.05);
        }
        
        /* Chat message styling */
        .chat-message {
            background-color: white;
            border-radius: 16px;
            padding: 16px 20px;
            margin: 8px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .chat-message.bot {
            text-align: left;
            color: #374151;
            font-weight: 500;
        }
        
        /* White panel styling */
        .white-panel {
            background-color: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin: 24px 0;
        }
        
        /* Results cards container */
        .results-container {
            background-color: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
    </style>
</head>
<body class="font-sans min-h-screen" style="background-color: #F8F4FF;">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Hero Section - Always Visible -->
        <div class="text-center space-y-6 mb-8">
            <div class="space-y-4">
                <h1 class="text-gray-900 max-w-2xl mx-auto text-4xl md:text-5xl font-bold">
                    Let's find a therapist who's right for you
                </h1>
                <p class="text-gray-600 max-w-xl mx-auto text-lg">
                    Answer a few quick questions — we'll guide you to someone who really gets it.
                </p>
            </div>
            <button 
                id="startBtn"
                onclick="startMatching()"
                class="rounded-2xl px-8 py-4 text-white shadow-sm hover:shadow-md transition-all text-lg font-semibold"
                style="background-color: #9B74B7"
            >
                Start Matching
            </button>
        </div>

        <!-- Chat Interface -->
        <div id="chatInterface" class="hidden">
            <div class="white-panel max-w-2xl mx-auto">
                <!-- Progress Bar -->
                <div class="flex items-center justify-between mb-6">
                    <div class="flex space-x-2">
                        <div class="progress-dot w-3 h-3 rounded-full bg-gray-200"></div>
                        <div class="progress-dot w-3 h-3 rounded-full bg-gray-200"></div>
                        <div class="progress-dot w-3 h-3 rounded-full bg-gray-200"></div>
                        <div class="progress-dot w-3 h-3 rounded-full bg-gray-200"></div>
                        <div class="progress-dot w-3 h-3 rounded-full bg-gray-200"></div>
                    </div>
                    <span id="progressText" class="text-sm text-gray-500">1 of 5</span>
                </div>

                <!-- Chat Messages -->
                <div id="chatMessages" class="space-y-4 mb-6">
                    <!-- Messages will be added here dynamically -->
                </div>

                <!-- Options Container -->
                <div id="optionsContainer" class="space-y-3">
                    <!-- Options will be added here dynamically -->
                </div>
            </div>
            
        </div>
        

        <!-- Results Section -->
        <div id="resultsSection" class="hidden">
            <div class="text-center space-y-4 mb-8">
                <h2 class="text-gray-900 text-3xl font-bold">Here are your matches</h2>
                <p class="text-gray-600 text-lg">Based on your responses, we think you'll connect well with:</p>
            </div>
            
            <div id="therapistCards" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6 lg:gap-8 mb-8">
                <!-- Therapist cards will be added here -->
            </div>
            
            <div class="text-center space-y-4">
                <p class="text-sm text-gray-500">Not quite right?</p>
                <div class="flex flex-col sm:flex-row gap-3 justify-center">
                        <button onclick="restartQuiz()" class="text-purple-700 hover:text-purple-800 text-sm underline font-medium" style="color: #9B74B7">
                            Retake quiz
                        </button>
                        <button class="text-purple-700 hover:text-purple-800 text-sm underline font-medium" style="color: #9B74B7">
                            Explore all therapists
                        </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-16 pt-8 border-t border-gray-100">
            <div class="space-y-2">
                <p class="text-sm text-gray-600">
                    Powered by Therapair for Unison
                </p>
                <p class="text-xs text-gray-400">
                    Find mental health support that understands you
                </p>
            </div>
        </div>
    </div>

    <script>
        // Therapist data - from Therapist team info.md
        const therapists = [
            {
                name: "Nicki Nelis",
                gender: "female",
                image: "./images/optimized/nicki-nelis-therapair-counsellor.jpg",
                tagline: "Gestalt therapist with nearly 20 years' experience, specializing in LGBTQI+, trauma survivors, and kink/ENM communities",
                specialties: ["LGBTQI+ affirming", "Trauma survivors", "Kink community", "ENM relationships", "Sexual assault survivors"],
                availability: "In-person Windsor (Thursdays 10am–7pm)",
                tags: ["lgbtq", "trauma", "kink", "enm", "identity"],
                accepting: true
            },
            {
                name: "Adam Forman",
                gender: "male",
                image: "./images/optimized/adam-forman-therapair-counsellor.jpg",
                tagline: "Counsellor & Mediator with two decades experience, specializing in ethically non-monogamous relationships",
                specialties: ["ENM relationships", "Opening relationships", "Relationship dynamics", "Attachment healing", "Mediation"],
                availability: "Online & in-person Fitzroy North (Flexible)",
                tags: ["enm", "relationship", "mediation"],
                accepting: true
            },
            {
                name: "Natasha Lama",
                gender: "female",
                image: "./images/optimized/natasha-lama-therapair-sex-therapist.jpg",
                tagline: "Counsellor & Sex Therapist with cultural sensitivity, specializing in sex-positive approaches and cultural identity",
                specialties: ["Sex therapy", "Cultural sensitivity", "Sexual health", "Cultural identity", "CBT", "Mindfulness"],
                availability: "Online and in-person Windsor (Mondays noon–7pm, Saturdays 9am–2pm)",
                tags: ["sexual_health", "cultural", "sex_positive"],
                accepting: true
            },
            {
                name: "Genevieve Autret",
                gender: "female",
                image: "./images/optimized/genevieve-autret-therapair-psychotherapist.jpg",
                tagline: "Psychotherapist with 15 years experience, specializing in psychedelic integration and trauma-informed therapy",
                specialties: ["Psychedelic integration", "Trauma therapy", "DBT", "Art therapy", "Harm reduction", "Couples therapy"],
                availability: "Online (Tuesdays 4:30–6:30pm, Wednesdays noon–6pm)",
                tags: ["psychedelic", "trauma", "art_therapy"],
                accepting: true
            },
            {
                name: "Emma Steains",
                gender: "female",
                image: "./images/optimized/emma-steains-therapair-clinical-psychologist.jpg",
                tagline: "Clinical Psychologist specializing in veterans/ADF personnel, EMDR, ACT, and trauma recovery",
                specialties: ["EMDR", "ACT", "CBT", "Veteran support", "ADF families", "Trauma recovery", "Internal Family Systems"],
                availability: "Online (Wednesdays 2–6pm, Fridays 9am–5pm)",
                tags: ["emdr", "veterans", "trauma", "cbt"],
                accepting: true
            },
            {
                name: "Michael Spurrier",
                gender: "male",
                image: "./images/optimized/michael-spurrier-therapair-clinical-psychologist.jpg",
                tagline: "Clinical Psychologist providing warm, grounded therapy for trauma, relationships, neurodivergence, mood, and addiction",
                specialties: ["Trauma therapy", "Relationship work", "Neurodivergent support", "Mood disorders", "Addiction", "Schema therapy"],
                availability: "Online (Mondays 9am–3pm)",
                tags: ["trauma", "relationship", "addiction", "neurodivergent"],
                accepting: true
            },
            {
                name: "Meg Wilson",
                gender: "female",
                image: "./images/optimized/meg-wilson-therapair-psychotherapist.jpg",
                tagline: "Founder & Psychotherapist with over a decade experience in art psychotherapy, DBT, and relationship therapy",
                specialties: ["Art psychotherapy", "DBT", "Mindfulness", "Relationship therapy", "Non-traditional relationships"],
                availability: "Online/in-person Windsor (Not currently accepting new clients)",
                tags: ["art_therapy", "relationship", "founder"],
                accepting: false
            },
            {
                name: "Joe Stark",
                gender: "male",
                image: "./images/optimized/joe-stark-therapair-psychiatrist.jpg",
                tagline: "Psychiatrist & Psychotherapist, pioneer in psychedelic-assisted therapy and mindfulness teacher",
                specialties: ["Psychiatry", "Psychedelic therapy", "Mindfulness", "Chronic pain", "Trauma", "Anxiety"],
                availability: "Not accepting new clients; medication-assisted treatments by enquiry",
                tags: ["psychedelic", "psychiatry", "mindfulness"],
                accepting: false
            }
        ];

        // Questions data - from Therapist Matching Structure.md
        const questions = [
            {
                id: "concerns",
                text: "What brings you to therapy?",
                options: [
                    "Relationship challenges",
                    "Anxiety or depression", 
                    "Trauma or PTSD",
                    "Personal growth/self-exploration",
                    "Identity exploration",
                    "Sexual health concerns",
                    "Addiction recovery",
                    "Psychedelic integration"
                ]
            },
            {
                id: "relationship",
                text: "Which relationship structure applies to you?",
                options: [
                    "Monogamous relationship",
                    "Non-monogamous/ENM relationship", 
                    "Single/dating",
                    "Not relevant to my needs"
                ]
            },
            {
                id: "approach",
                text: "Do you have preferences regarding therapeutic approaches?",
                options: [
                    "Art-based therapy",
                    "CBT/DBT skills-focused", 
                    "Mindfulness/acceptance-based",
                    "Trauma-specific approaches (EMDR)",
                    "No preference/unsure"
                ]
            },
            {
                id: "community",
                text: "Are any of these community experiences relevant to you?",
                options: [
                    "LGBTQI+ community",
                    "Cultural/ethnic minority", 
                    "Veterans/ADF personnel or family",
                    "Kink community",
                    "None of these apply"
                ]
            },
            {
                id: "gender",
                text: "Therapist gender preference?",
                options: [
                    "Prefer female therapist",
                    "Prefer male therapist", 
                    "No preference"
                ]
            }
        ];

        let currentQuestion = 0;
        let responses = {};

        function startMatching() {
            // Reset variables and UI
            currentQuestion = 0;
            responses = {};
            
            // Clear any existing content
            document.getElementById('chatMessages').innerHTML = '';
            document.getElementById('optionsContainer').innerHTML = '';
            
            // Reset progress indicators
            const progressDots = document.querySelectorAll('.progress-dot');
            progressDots.forEach(dot => {
                dot.classList.remove('active');
            });
            
            // Reset progress text
            document.getElementById('progressText').textContent = '1 of 5';
            
            // Hide start button and show chat interface (hero title stays visible)
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('chatInterface').classList.remove('hidden');
            
            showQuestion(0);
        }

        function showQuestion(index) {
            currentQuestion = index;
            const question = questions[index];
            
            // Update progress
            updateProgress(index);
            
            // Clear previous messages and options
            document.getElementById('chatMessages').innerHTML = '';
            document.getElementById('optionsContainer').innerHTML = '';
            
            // Add question as chat bubble
            addChatBubble(question.text, 'bot');
            
            // Add options
            setTimeout(() => {
                question.options.forEach((option, i) => {
                    setTimeout(() => {
                        addOptionButton(option);
                    }, i * 100);
                });
            }, 500);
        }

        function updateProgress(index) {
            const dots = document.querySelectorAll('.progress-dot');
            const progressText = document.getElementById('progressText');
            
            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i <= index);
            });
            
            progressText.textContent = `${index + 1} of ${questions.length}`;
        }

        function addChatBubble(message, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const bubble = document.createElement('div');
            
            if (sender === 'bot') {
                bubble.className = 'chat-message bot';
                bubble.innerHTML = message;
            } else {
                bubble.className = 'chat-bubble flex justify-end';
                bubble.innerHTML = `
                    <div class="max-w-xs lg:max-w-md px-4 py-3 rounded-2xl text-white" style="background-color: #9B74B7">
                        ${message}
                    </div>
                `;
            }
            
            chatMessages.appendChild(bubble);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addOptionButton(option) {
            const container = document.getElementById('optionsContainer');
            const button = document.createElement('button');
            
            button.className = 'option-button w-full text-left py-4 px-6 rounded-xl border-2 border-gray-200 hover:border-gray-300 text-base transition-all';
            button.textContent = option;
            
            button.onclick = () => selectOption(option, button);
            
            container.appendChild(button);
        }

        function selectOption(option, buttonElement) {
            // Mark as selected
            buttonElement.classList.add('selected');
            buttonElement.disabled = true;
            
            // Store response
            responses[questions[currentQuestion].id] = option;
            
            // Disable other options
            const allOptions = document.querySelectorAll('.option-button');
            allOptions.forEach(opt => opt.disabled = true);
            
            // Move to next question or show results
            setTimeout(() => {
                if (currentQuestion < questions.length - 1) {
                    showQuestion(currentQuestion + 1);
                } else {
                    showResults();
                }
            }, 1000);
        }

        function showResults() {
            document.getElementById('chatInterface').classList.add('hidden');
            document.getElementById('resultsSection').classList.remove('hidden');
            // Keep "Powered by" section visible
            
            const matchedTherapists = getMatchedTherapists();
            displayTherapistCards(matchedTherapists);
        }

        function getMatchedTherapists() {
            const genderPreference = responses.gender;
            
            // Only include therapists who are accepting new clients
            const acceptingTherapists = therapists.filter(t => t.accepting);
            
            // Filter by gender preference
            let eligibleTherapists = acceptingTherapists;
            if (genderPreference === 'Prefer male therapist') {
                eligibleTherapists = acceptingTherapists.filter(t => t.gender === 'male');
            } else if (genderPreference === 'Prefer female therapist') {
                eligibleTherapists = acceptingTherapists.filter(t => t.gender === 'female');
            }
            
            const matches = [];
            const concerns = responses.concerns;
            const relationship = responses.relationship;
            const approach = responses.approach;
            const community = responses.community;

            // Apply matching logic from Therapist Matching Structure.md
            
            // For relationship therapy → Meg (primary) or Adam for ENM
            if (concerns === 'Relationship challenges') {
                if (relationship === 'Non-monogamous/ENM relationship') {
                    matches.push(...eligibleTherapists.filter(t => t.tags.includes('enm')));
                } else {
                    matches.push(...eligibleTherapists.filter(t => t.tags.includes('relationship')));
                }
            }
            
            // For ENM-specific needs → Adam (primary) or Nicky
            if (relationship === 'Non-monogamous/ENM relationship') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('enm') || t.tags.includes('kink')));
            }
            
            // For LGBTQI+/kink community → Nicky (primary)
            if (community === 'LGBTQI+ community' || community === 'Kink community') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('lgbtq') || t.tags.includes('kink')));
            }
            
            // For psychedelic integration → Genevieve
            if (concerns === 'Psychedelic integration') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('psychedelic')));
            }
            
            // For veterans/ADF personnel → Emma
            if (community === 'Veterans/ADF personnel or family') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('veterans')));
            }
            
            // For sexual health concerns → Natasha
            if (concerns === 'Sexual health concerns') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('sexual_health')));
            }
            
            // For trauma with EMDR preference → Emma or Genevieve
            if (concerns === 'Trauma or PTSD' || approach === 'Trauma-specific approaches (EMDR)') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('trauma') || t.tags.includes('emdr')));
            }
            
            // For cultural/ethnic minority concerns → Natasha
            if (community === 'Cultural/ethnic minority') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('cultural')));
            }
            
            // For identity exploration → Nicky
            if (concerns === 'Identity exploration') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('identity') || t.tags.includes('lgbtq')));
            }
            
            // For art-based therapy → Genevieve or Meg
            if (approach === 'Art-based therapy') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('art_therapy')));
            }
            
            // For addiction recovery → Michael
            if (concerns === 'Addiction recovery') {
                matches.push(...eligibleTherapists.filter(t => t.tags.includes('addiction')));
            }

            // Remove duplicates
            const uniqueMatches = matches.filter((therapist, index, self) => 
                index === self.findIndex(t => t.name === therapist.name)
            );
            
            // If no matches found, provide fallback from eligible therapists
            let finalMatches = uniqueMatches;
            if (finalMatches.length === 0) {
                finalMatches = eligibleTherapists.slice(0, 3);
            }
            
            // Return 1-3 matches (as per structure document)
            return finalMatches.slice(0, 3);
        }

        function displayTherapistCards(therapists) {
            const container = document.getElementById('therapistCards');
            
            therapists.forEach((therapist, index) => {
                setTimeout(() => {
                    const card = createTherapistCard(therapist);
                    container.appendChild(card);
                }, index * 200);
            });
        }

        function createTherapistCard(therapist) {
            const card = document.createElement('div');
            card.className = 'therapist-card bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden h-full flex flex-col group';
            
            // DEBUG: Log image path
            console.log(`Loading image for ${therapist.name}: ${therapist.image}`);
            
            card.innerHTML = `
                <div class="relative">
                    <div class="aspect-square overflow-hidden">
                        <img
                            src="${therapist.image}"
                            alt="${therapist.name} - Therapist at Therapair"
                            class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                            onload="console.log('Image loaded successfully:', '${therapist.name}')"
                            onerror="console.error('Image failed to load:', '${therapist.name}', '${therapist.image}'); this.src='https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?w=640&h=640&fit=crop&crop=face'"
                        />
                    </div>
                    <div class="absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent"></div>
                </div>
                
                <div class="p-6 flex-1 flex flex-col">
                    <div class="mb-4">
                        <h3 class="text-gray-900 mb-2 text-xl font-bold">${therapist.name}</h3>
                        <p class="text-gray-600 text-sm leading-relaxed">${therapist.tagline}</p>
                    </div>
                    
                    <div class="mb-6 flex-1">
                        <p class="text-sm text-gray-500 mb-3 font-medium">Specializes in:</p>
                        <div class="flex flex-wrap gap-2">
                            ${therapist.specialties.slice(0, 3).map(specialty => `
                                <span class="text-xs px-3 py-1.5 rounded-full font-medium text-white" style="background-color: #9B74B7">
                                    ${specialty}
                                </span>
                            `).join('')}
                            ${therapist.specialties.length > 3 ? `
                                <span class="bg-gray-50 text-gray-600 border border-gray-200 text-xs px-3 py-1.5 rounded-full">
                                    +${therapist.specialties.length - 3} more
                                </span>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div class="space-y-3 mt-auto">
                        <button class="w-full bg-white border-2 hover:bg-gray-50 text-gray-700 rounded-xl px-6 py-3 font-medium transition-colors" style="border-color: #9B74B7">
                            View Profile
                        </button>
                        <button class="w-full text-white rounded-xl px-6 py-3 shadow-sm hover:shadow-md transition-all font-semibold" style="background-color: #9B74B7">
                            Book Now
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }

        function restartQuiz() {
            // Reset all variables to initial state
            currentQuestion = 0;
            responses = {};
            
            // Clear all chat messages and options
            document.getElementById('chatMessages').innerHTML = '';
            document.getElementById('optionsContainer').innerHTML = '';
            
            // Reset progress indicators
            const progressDots = document.querySelectorAll('.progress-dot');
            progressDots.forEach(dot => {
                dot.classList.remove('active');
            });
            
            // Reset progress text
            document.getElementById('progressText').textContent = '1 of 5';
            
            // Hide results section and show chat interface
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('chatInterface').classList.remove('hidden');
            document.getElementById('startBtn').style.display = 'none';
            
            // Clear therapist cards container
            const therapistCards = document.getElementById('therapistCards');
            if (therapistCards) {
                therapistCards.innerHTML = '';
            }
            
            // Start fresh
            showQuestion(0);
        }
    </script>
</body>
</html>
