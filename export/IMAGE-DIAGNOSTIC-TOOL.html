<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Loading Diagnostic Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-image {
            width: 150px;
            height: 150px;
            margin: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            object-fit: cover;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        .success {
            color: #27ae60;
            font-weight: bold;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
        }
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .image-test {
            text-align: center;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Therapair Widget - Image Loading Diagnostic</h1>
        <p>This tool helps diagnose why images aren't loading in your Therapair widget.</p>

        <h2>üìã Quick Tests</h2>
        <button onclick="runDiagnostics()" style="background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">
            Run Image Diagnostics
        </button>

        <div id="results" class="results" style="display: none;">
            <h3>üîß Diagnostic Results</h3>
            <div id="test-results"></div>
        </div>

        <h2>üì∏ Image Loading Tests</h2>
        <div class="image-grid" id="image-tests">
            <!-- Test images will be added here -->
        </div>

        <h2>üìù Manual Checks</h2>
        <div style="background: #fff3cd; padding: 15px; border-radius: 4px; margin: 20px 0;">
            <h4>1. Check these URLs manually:</h4>
            <ul id="manual-urls">
                <!-- URLs will be populated here -->
            </ul>
        </div>

        <div style="background: #d1ecf1; padding: 15px; border-radius: 4px; margin: 20px 0;">
            <h4>2. Open Browser Console (F12) and look for:</h4>
            <ul>
                <li>404 errors ‚Üí Files not uploaded</li>
                <li>403 errors ‚Üí Permission issues</li>
                <li>CORS errors ‚Üí Cross-origin issues</li>
                <li>Mixed content warnings ‚Üí HTTP/HTTPS issues</li>
            </ul>
        </div>
    </div>

    <script>
        const imageFiles = [
            'adam.jpeg',
            'emma.jpeg',
            'genevieve.jpeg',
            'joe.jpeg',
            'meg.jpeg',
            'michael.jpeg',
            'natasha.jpeg',
            'nicki.jpeg'
        ];

        const imagePaths = [
            './images/',
            'images/',
            '/images/',
            '../images/',
            '/therapair-widget/images/',
            './therapair-widget/images/'
        ];

        function runDiagnostics() {
            const resultsDiv = document.getElementById('results');
            const testResultsDiv = document.getElementById('test-results');

            resultsDiv.style.display = 'block';
            testResultsDiv.innerHTML = '<p>Running diagnostics...</p>';

            // Test current page location
            const currentUrl = window.location.href;
            const baseUrl = currentUrl.substring(0, currentUrl.lastIndexOf('/') + 1);

            let diagnosticHTML = `
                <p><strong>Current Page:</strong> ${currentUrl}</p>
                <p><strong>Base URL:</strong> ${baseUrl}</p>
                <p><strong>Testing ${imageFiles.length} images with ${imagePaths.length} different path patterns...</strong></p>
            `;

            // Test image loading
            let testsCompleted = 0;
            const totalTests = imageFiles.length * imagePaths.length;
            let successfulPaths = [];

            imageFiles.forEach(filename => {
                imagePaths.forEach(path => {
                    const fullUrl = baseUrl + path + filename;

                    const img = new Image();
                    img.onload = function() {
                        successfulPaths.push({ filename, path, url: fullUrl });
                        testsCompleted++;
                        if (testsCompleted === totalTests) {
                            showResults(successfulPaths, diagnosticHTML);
                        }
                    };

                    img.onerror = function() {
                        testsCompleted++;
                        if (testsCompleted === totalTests) {
                            showResults(successfulPaths, diagnosticHTML);
                        }
                    };

                    img.src = fullUrl;
                });
            });

            // Create visual tests
            createVisualTests();
            createManualUrls();
        }

        function showResults(successfulPaths, diagnosticHTML) {
            const testResultsDiv = document.getElementById('test-results');

            if (successfulPaths.length > 0) {
                diagnosticHTML += `
                    <div class="success">
                        ‚úÖ Found ${successfulPaths.length} working image paths!
                    </div>
                    <h4>Working Paths:</h4>
                    <ul>
                `;

                successfulPaths.forEach(({ filename, path, url }) => {
                    diagnosticHTML += `<li><strong>${filename}</strong>: ${path} ‚Üí <a href="${url}" target="_blank">Test</a></li>`;
                });

                diagnosticHTML += '</ul>';

                // Find the best path pattern
                const pathCounts = {};
                successfulPaths.forEach(({ path }) => {
                    pathCounts[path] = (pathCounts[path] || 0) + 1;
                });

                const bestPath = Object.keys(pathCounts).reduce((a, b) =>
                    pathCounts[a] > pathCounts[b] ? a : b
                );

                diagnosticHTML += `
                    <div style="background: #d4edda; padding: 10px; border-radius: 4px; margin: 10px 0;">
                        <strong>‚úÖ Recommended Path:</strong> <code>${bestPath}</code><br>
                        <small>Update your widget's getImagePath() function to use this path.</small>
                    </div>
                `;
            } else {
                diagnosticHTML += `
                    <div class="error">
                        ‚ùå No working image paths found!
                    </div>
                    <h4>Possible Issues:</h4>
                    <ul>
                        <li>Images folder not uploaded</li>
                        <li>Files uploaded to wrong location</li>
                        <li>File permission issues (need 644 for files, 755 for folders)</li>
                        <li>Server configuration blocking .jpeg files</li>
                        <li>Case sensitivity issues (Linux servers)</li>
                    </ul>
                `;
            }

            testResultsDiv.innerHTML = diagnosticHTML;
        }

        function createVisualTests() {
            const container = document.getElementById('image-tests');
            container.innerHTML = '';

            imageFiles.forEach(filename => {
                const testDiv = document.createElement('div');
                testDiv.className = 'image-test';

                const img = document.createElement('img');
                img.className = 'test-image';
                img.alt = filename;

                const status = document.createElement('div');
                status.textContent = filename;

                img.onload = function() {
                    status.innerHTML = `<span class="success">‚úÖ ${filename}</span>`;
                };

                img.onerror = function() {
                    status.innerHTML = `<span class="error">‚ùå ${filename}</span>`;
                    img.style.background = '#f8f9fa';
                    img.style.display = 'flex';
                    img.style.alignItems = 'center';
                    img.style.justifyContent = 'center';
                    img.textContent = '?';
                };

                img.src = './images/' + filename;

                testDiv.appendChild(img);
                testDiv.appendChild(status);
                container.appendChild(testDiv);
            });
        }

        function createManualUrls() {
            const container = document.getElementById('manual-urls');
            container.innerHTML = '';

            const baseUrl = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);

            imagePaths.forEach(path => {
                const li = document.createElement('li');
                const testUrl = baseUrl + path + 'adam.jpeg';
                li.innerHTML = `<a href="${testUrl}" target="_blank">${testUrl}</a>`;
                container.appendChild(li);
            });
        }

        // Auto-run diagnostics on page load
        window.onload = function() {
            createVisualTests();
            createManualUrls();
        };
    </script>
</body>
</html>