<!--
IMPROVED ELEMENTOR HTML WIDGET CODE
Copy this code into an HTML widget in Elementor
-->

<div id="therapair-iframe-container" style="width: 100%; margin: 2rem 0;">
    <iframe
        id="therapair-iframe"
        src="/wp-content/themes/twentytwentyfour/therapair-widget-v2.html"
        width="100%"
        height="700"
        frameborder="0"
        scrolling="no"
        style="border-radius: 16px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); background: #F8F4FF; transition: height 0.3s ease;"
        title="Therapair Matching Widget"
        loading="lazy">
        <p>Your browser doesn't support iframes. Please <a href="/wp-content/themes/twentytwentyfour/therapair-widget-v2.html" target="_blank">click here</a> to access the therapist matching tool.</p>
    </iframe>
</div>

<script>
// Auto-resize iframe based on content height
let lastHeight = 700;

function resizeTherapairIframe(height) {
    const iframe = document.getElementById('therapair-iframe');
    if (iframe && height && height !== lastHeight) {
        // Add some padding to prevent cut-off
        const newHeight = Math.max(height + 50, 700);
        iframe.style.height = newHeight + 'px';
        lastHeight = newHeight;
        console.log('Therapair iframe resized to:', newHeight + 'px');
    }
}

// Listen for resize messages from the iframe
window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'therapair-resize') {
        resizeTherapairIframe(event.data.height);
    }
});

// Try to access iframe content directly (only works if same domain)
function tryDirectResize() {
    const iframe = document.getElementById('therapair-iframe');
    if (iframe) {
        try {
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            if (iframeDoc && iframeDoc.body) {
                const height = iframeDoc.body.scrollHeight;
                resizeTherapairIframe(height);
            }
        } catch (e) {
            // Cross-origin restriction, rely on postMessage
            console.log('Using postMessage for iframe resize (cross-origin)');
        }
    }
}

// Check for resize on load
window.addEventListener('load', function() {
    setTimeout(tryDirectResize, 1000);
});

// Periodic check for content changes (fallback)
setInterval(tryDirectResize, 2000);

// Handle iframe load event
document.getElementById('therapair-iframe').addEventListener('load', function() {
    setTimeout(tryDirectResize, 500);
});
</script>

<style>
/* Optional: Custom styling for the iframe container */
#therapair-iframe-container {
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    #therapair-iframe-container {
        margin: 1rem 0;
    }

    #therapair-iframe {
        min-height: 800px !important; /* Mobile needs more height */
        border-radius: 8px !important;
    }
}

@media (max-width: 480px) {
    #therapair-iframe-container {
        margin: 0.5rem 0;
    }

    #therapair-iframe {
        min-height: 900px !important;
        border-radius: 4px !important;
    }
}

/* Loading state */
#therapair-iframe {
    opacity: 0;
    transition: opacity 0.3s ease, height 0.3s ease;
}

#therapair-iframe.loaded {
    opacity: 1;
}
</style>

<script>
// Add loaded class when iframe is ready
document.getElementById('therapair-iframe').addEventListener('load', function() {
    this.classList.add('loaded');
});

// Show iframe after short delay
setTimeout(function() {
    const iframe = document.getElementById('therapair-iframe');
    if (iframe) {
        iframe.style.opacity = '1';
    }
}, 100);
</script>